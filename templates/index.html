<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>DualLex Agent</title>
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<style>

    body {
        font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", sans-serif;
        margin: 0;
        padding: 40px;
        background: #f5f5f7;
        color: #111;
    }

    #container {
        max-width: 700px;
        margin: auto;
    }

    h1 {
        font-weight: 600;
        margin-bottom: 25px;
    }

    input {
        width: 100%;
        padding: 14px;
        font-size: 18px;
        border-radius: 10px;
        border: 1px solid #ccc;
        margin-bottom: 15px;
        box-sizing: border-box;
    }

    button {
        padding: 12px 22px;
        font-size: 16px;
        border: none;
        border-radius: 8px;
        background: #0071e3;
        color: #fff;
        cursor: pointer;
        margin-bottom: 30px;
    }

    button:hover {
        background: #005bb5;
    }

    .card {
        background: white;
        padding: 20px;
        border-radius: 14px;
        margin-bottom: 30px;
        font-family: Menlo, monospace;
        white-space: pre-wrap;
        border: 1px solid #e0e0e0;
    }

    .title {
        font-size: 20px;
        margin-bottom: 10px;
        font-weight: 600;
    }

</style>
</head>
<body>

<div id="container">

<h1>DualLex Agent</h1>

<input id="word" placeholder="Enter a word (English or Arabic)">
<button onclick="lookup()">Lookup</button>

<div class="title">Agent Status</div>
<div id="status" class="card">Waitingâ€¦</div>

<div class="title">Final JSON Output</div>
<div id="json-output" class="card">{}</div>

</div>

<script>
const BACKEND = "https://YOUR-RENDER-URL.onrender.com";  // <--- CHANGE THIS

async function lookup() {
    const word = document.getElementById("word").value.trim();
    const statusBox = document.getElementById("status");
    const jsonBox = document.getElementById("json-output");

    if (!word) {
        alert("Enter a word first.");
        return;
    }

    statusBox.textContent = "Starting agent...\n";
    jsonBox.textContent = "{}";

    // POST request but with streaming response body
    const response = await fetch(BACKEND + "/lookup", {
        method: "POST",
        headers: { "Content-Type": "application/json" },
        body: JSON.stringify({ word })
    });

    const reader = response.body.getReader();
    const decoder = new TextDecoder();
    let buffer = "";

    while (true) {
        const { done, value } = await reader.read();
        if (done) break;

        buffer += decoder.decode(value, { stream: true });

        const chunks = buffer.split("\n\n");

        for (let i = 0; i < chunks.length - 1; i++) {
            const chunk = chunks[i];

            if (!chunk.startsWith("data: ")) continue;

            const jsonString = chunk.replace("data: ", "").trim();

            try {
                const evt = JSON.parse(jsonString);

                // Display the entire event as a JSON block
                statusBox.textContent +=
                    JSON.stringify(evt, null, 2) + "\n\n";

                // If this is the final agent JSON output
                if (evt.event === "final_output" && evt.output) {
                    jsonBox.textContent =
                        JSON.stringify(evt.output, null, 2);
                }
            } catch (e) {
                // ignore partial chunks
            }
        }

        buffer = chunks[chunks.length - 1];
    }
}
</script>

</body>
</html>
